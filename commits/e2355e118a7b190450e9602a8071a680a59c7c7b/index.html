<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Use the title from a page's frontmatter if it has one -->
    <title>View other nearby Locations</title>
    <link href="../../stylesheets/site.css" rel="stylesheet" />
    <script src="../../javascripts/site.js"></script>
  </head>
  <body class="page">
    <header class="header">
      <h1 class="header__name">
<a href="../../">          rec-it-ralph
</a>      </h1>


      <nav class="
        header__navigation
        navigation
        
      ">
<a href="../647515fbdf76371180392b804961d117c07558bf/">              &#8592; Previous
</a>
<a href="../93bb0c491877c8051b51daaffdbb531adbe8b196/">              Next &#8594;
</a>      </nav>
    </header>

    <main class="content">
      <details class="accordion content__item">
        <summary class="accordion__summary">
          <div class="accordion__closed">
            <nav class="
              commit-history
              u-db-overflow-y--auto
              u-mb-overflow-x--scroll
            ">
                <a href="../4ca338863b78e18ed7be316a5442c116136dc5d9/" class="commit-node commit-node--collapsed" title="[SKIP]: Create `git-read` GitHub Action
"></a>
                <a href="../44ee2d1227991296dead3ca7d6ded221e409d26f/" class="commit-node commit-node--collapsed" title="[GENERATED]: Initial Commit
"></a>
                <a href="../e05d0f4bdbac2a95262b7cb7390539c184a51268/" class="commit-node commit-node--collapsed" title="[GENERATED]: Install ActiveStorage and ActionText
"></a>
                <a href="../9b386fad46eecda08db92e8fe4afe37943d042d5/" class="commit-node commit-node--collapsed" title="[SKIP]: Install TailwindCSS
"></a>
                <a href="../952ad9fde3ab9c87a2553b0387f33656d2bf7a43/" class="commit-node commit-node--collapsed" title="View Locations near thoughtbot NYC
"></a>
                <a href="../647515fbdf76371180392b804961d117c07558bf/" class="commit-node commit-node--collapsed" title="View Users and the Locations they've added"></a>
                <a href="./" class="commit-node commit-node--collapsed" title="View other nearby Locations" aria-current="page"></a>
                <a href="../93bb0c491877c8051b51daaffdbb531adbe8b196/" class="commit-node commit-node--collapsed" title="View rich text Recommendations from Users"></a>
                <a href="../d7b75c780c376a916186f0ea2c449cd3d161920e/" class="commit-node commit-node--collapsed" title="Style with TailwindCSS"></a>
                <a href="../ac7c272f40b628dd3e9dfd8e57701966cb1d7db6/" class="commit-node commit-node--collapsed" title="Mobile: Switch between Map and List"></a>
                <a href="../fe3325b1ca71ce8412eb7dff608a67a242d273f6/" class="commit-node commit-node--collapsed" title="Sliding drawer Search results on Mobile"></a>
                <a href="../e612f73dbf6aaf8d47a575a9f1d3686f38f728c9/" class="commit-node commit-node--collapsed" title="Render the Locations on a Leaflet map"></a>
                <a href="../0911bea49692e6015fb17effa6c92e9a1d0acf37/" class="commit-node commit-node--collapsed" title="Pan around the map to “Search this Area”"></a>
                <a href="../a67f67586127053eee0e3dc6765cc03c15deea39/" class="commit-node commit-node--collapsed" title="Clicking on a Card pans the map"></a>
                <a href="../c9bb2feb0f1cc5c9e5263f8e04b5e676e620c030/" class="commit-node commit-node--collapsed" title="[GENERATED]: Initial Commit for iOS Application"></a>
                <a href="../f791760bfb8b02479de18af96f892d48c8c9de54/" class="commit-node commit-node--collapsed" title="Wire up Rec-It-Ralph-ios"></a>
                <a href="../6891dc5fcde3f046792bf3b85ea2bbe695d599b1/" class="commit-node commit-node--collapsed" title="Add iOS platform-specific styles"></a>
                <a href="../be77eda5a3383805d178b26c8eba5f8ca79dbbf4/" class="commit-node commit-node--collapsed" title="prototyping with SwiftUI: both directions"></a>
            </nav>

            <div class="accordion__toggle">
              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--desktop"><title>Expand History</title>
  <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--mobile"><title>Expand History</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>

            </div>
          </div>

          <div class="accordion__opened">
            <div class="accordion__toggle accordion__toggle--fill">
              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--desktop"><title>Collapse History</title>
  <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 010 .708L5.707 8l5.647 5.646a.5.5 0 01-.708.708l-6-6a.5.5 0 010-.708l6-6a.5.5 0 01.708 0z" clip-rule="evenodd"></path>
</svg>


              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--mobile"><title>Collapse History</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>

            </div>
          </div>
        </summary>

        <nav class="
          commit-history
          commit-history--full
          u-db-overflow-y--auto
          u-mb-overflow-x--scroll
        ">
<a href="../4ca338863b78e18ed7be316a5442c116136dc5d9/" class="commit-node commit-node--full">              <p>[SKIP]: Create <code>git-read</code> GitHub Action</p>

</a><a href="../44ee2d1227991296dead3ca7d6ded221e409d26f/" class="commit-node commit-node--full">              <p>[GENERATED]: Initial Commit</p>

</a><a href="../e05d0f4bdbac2a95262b7cb7390539c184a51268/" class="commit-node commit-node--full">              <p>[GENERATED]: Install ActiveStorage and ActionText</p>

</a><a href="../9b386fad46eecda08db92e8fe4afe37943d042d5/" class="commit-node commit-node--full">              <p>[SKIP]: Install TailwindCSS</p>

</a><a href="../952ad9fde3ab9c87a2553b0387f33656d2bf7a43/" class="commit-node commit-node--full">              <p>View Locations near thoughtbot NYC</p>

</a><a href="../647515fbdf76371180392b804961d117c07558bf/" class="commit-node commit-node--full">              <p>View Users and the Locations they&#39;ve added</p>

</a><a href="./" class="commit-node commit-node--full" aria-current="page">              <p>View other nearby Locations</p>

</a><a href="../93bb0c491877c8051b51daaffdbb531adbe8b196/" class="commit-node commit-node--full">              <p>View rich text Recommendations from Users</p>

</a><a href="../d7b75c780c376a916186f0ea2c449cd3d161920e/" class="commit-node commit-node--full">              <p>Style with TailwindCSS</p>

</a><a href="../ac7c272f40b628dd3e9dfd8e57701966cb1d7db6/" class="commit-node commit-node--full">              <p>Mobile: Switch between Map and List</p>

</a><a href="../fe3325b1ca71ce8412eb7dff608a67a242d273f6/" class="commit-node commit-node--full">              <p>Sliding drawer Search results on Mobile</p>

</a><a href="../e612f73dbf6aaf8d47a575a9f1d3686f38f728c9/" class="commit-node commit-node--full">              <p>Render the Locations on a Leaflet map</p>

</a><a href="../0911bea49692e6015fb17effa6c92e9a1d0acf37/" class="commit-node commit-node--full">              <p>Pan around the map to “Search this Area”</p>

</a><a href="../a67f67586127053eee0e3dc6765cc03c15deea39/" class="commit-node commit-node--full">              <p>Clicking on a Card pans the map</p>

</a><a href="../c9bb2feb0f1cc5c9e5263f8e04b5e676e620c030/" class="commit-node commit-node--full">              <p>[GENERATED]: Initial Commit for iOS Application</p>

</a><a href="../f791760bfb8b02479de18af96f892d48c8c9de54/" class="commit-node commit-node--full">              <p>Wire up Rec-It-Ralph-ios</p>

</a><a href="../6891dc5fcde3f046792bf3b85ea2bbe695d599b1/" class="commit-node commit-node--full">              <p>Add iOS platform-specific styles</p>

</a><a href="../be77eda5a3383805d178b26c8eba5f8ca79dbbf4/" class="commit-node commit-node--full">              <p>prototyping with SwiftUI: both directions</p>

</a>        </nav>
      </details>

      <article class="
        commit-content
        commit-content--double
        content__item
        content__item--grow
      ">
        <section class="commit commit--message">

          <h1 id="view-other-nearby-locations">View other nearby Locations</h1>

        </section>

          <aside class="commit commit--diff commit--long-content">
              <details
  id="app/models/location.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/models/location.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/models/location.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/models/location.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/models/location.rb b/app/models/location.rb
index 150ad93..23c501f 100644
</span><span class="gd">--- a/app/models/location.rb
</span><span class="gi">+++ b/app/models/location.rb
</span><span class="p">@@ -7,6 +7,10 @@</span> class Location &lt; ApplicationRecord
 
   delegate :name, to: :locatable
 
<span class="gi">+  def nearby(*arguments)
+    Location.near(self, *arguments).where.not(id: self)
+  end
+
</span>   def address
     [ line1, city, state, postal_code, country ].join(", ")
   end
</code></pre></div></details>

              <details
  id="app/views/locations/show.html.erb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/views/locations/show.html.erb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/views/locations/show.html.erb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/views/locations/show.html.erb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/views/locations/show.html.erb b/app/views/locations/show.html.erb
index 9ef9f04..ab6f8a1 100644
</span><span class="gd">--- a/app/views/locations/show.html.erb
</span><span class="gi">+++ b/app/views/locations/show.html.erb
</span><span class="p">@@ -29,5 +29,16 @@</span>
 
     &lt;dt&gt;Tags&lt;/dt&gt;
     &lt;dd&gt;&lt;%= location.locatable_name.titleize %&gt;&lt;/dd&gt;
<span class="gi">+
+    &lt;% location.nearby(1, unit: :mi).tap do |nearby_locations| %&gt;
+      &lt;% if nearby_locations.any? %&gt;
+        &lt;dt&gt;Nearby&lt;dt&gt;
+        &lt;dd&gt;
+          &lt;ul&gt;
+            &lt;%= render layout: "li", partial: nearby_locations %&gt;
+          &lt;/ul&gt;
+        &lt;/dd&gt;
+      &lt;% end %&gt;
+    &lt;% end %&gt;
</span>   &lt;/dl&gt;
 &lt;/section&gt;
</code></pre></div></details>

              <details
  id="test/controllers/locations_controller_test.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse test/controllers/locations_controller_test.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand test/controllers/locations_controller_test.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      test/controllers/locations_controller_test.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/controllers/locations_controller_test.rb b/test/controllers/locations_controller_test.rb
index 90865aa..300ec6b 100644
</span><span class="gd">--- a/test/controllers/locations_controller_test.rb
</span><span class="gi">+++ b/test/controllers/locations_controller_test.rb
</span><span class="p">@@ -1,10 +1,15 @@</span>
 require "test_helper"
 
 class LocationsControllerTest &lt; ActionDispatch::IntegrationTest
<span class="gi">+  include ActionView::Helpers::TextHelper
+
</span>   test "#index includes the number of results" do
<span class="gi">+    thoughtbot_nyc = offices(:thoughtbot_nyc)
+    nearby_locations = thoughtbot_nyc.nearby(1, unit: :mi)
+
</span>     get root_path
 
<span class="gd">-    assert_text /\d+ results/
</span><span class="gi">+    assert_text pluralize(nearby_locations.size + 1, "result")
</span>   end
 
   test "#index includes information about the Locations' creators" do
<span class="p">@@ -38,4 +43,23 @@</span> class LocationsControllerTest &lt; ActionDispatch::IntegrationTest
     assert_text thoughtbot_nyc.name
     assert_text thoughtbot_nyc.creator.name
   end
<span class="gi">+
+  test "#show renders other nearby Locations" do
+    thoughtbot_nyc = offices(:thoughtbot_nyc)
+    culture_espresso = cafes(:culture_espresso)
+    staten_island_mall = attractions(:staten_island_mall)
+
+    get location_path(thoughtbot_nyc.location)
+
+    assert_text culture_espresso.name
+    assert_no_text staten_island_mall.name
+  end
+
+  test "#hides the nearby header when there are no nearby Locations" do
+    staten_island_mall = attractions(:staten_island_mall)
+
+    get location_path(staten_island_mall.location)
+
+    assert_select "dt", count: 0, text: "Nearby"
+  end
</span> end
</code></pre></div></details>

              <details
  id="test/models/location_test.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse test/models/location_test.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand test/models/location_test.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      test/models/location_test.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/models/location_test.rb b/test/models/location_test.rb
index a1fbbcd..cfb1858 100644
</span><span class="gd">--- a/test/models/location_test.rb
</span><span class="gi">+++ b/test/models/location_test.rb
</span><span class="p">@@ -17,4 +17,34 @@</span> class LocationTest &lt; ActiveSupport::TestCase
     assert_equal thoughtbot_nyc.latitude, latitude
     assert_equal thoughtbot_nyc.longitude, longitude
   end
<span class="gi">+
+  test "#nearby excludes the Location" do
+    thoughtbot_nyc = offices(:thoughtbot_nyc)
+
+    nearby = thoughtbot_nyc.nearby
+
+    assert_not_includes nearby, thoughtbot_nyc.location
+  end
+
+  test "#nearby returns other Locations" do
+    thoughtbot_nyc = offices(:thoughtbot_nyc)
+    culture_espresso = cafes(:culture_espresso)
+    staten_island_mall = attractions(:staten_island_mall)
+
+    nearby = thoughtbot_nyc.nearby
+
+    assert_includes nearby, culture_espresso.location
+    assert_includes nearby, staten_island_mall.location
+  end
+
+  test "#nearby accepts a range and unit for filtering" do
+    thoughtbot_nyc = offices(:thoughtbot_nyc)
+    culture_espresso = cafes(:culture_espresso)
+    staten_island_mall = attractions(:staten_island_mall)
+
+    nearby = thoughtbot_nyc.nearby(1, unit: :mi)
+
+    assert_includes nearby, culture_espresso.location
+    assert_not_includes nearby, staten_island_mall.location
+  end
</span> end
</code></pre></div></details>

              <details
  id="test/test_helper.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse test/test_helper.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand test/test_helper.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      test/test_helper.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/test_helper.rb b/test/test_helper.rb
index 6b37d4a..1ea5f98 100644
</span><span class="gd">--- a/test/test_helper.rb
</span><span class="gi">+++ b/test/test_helper.rb
</span><span class="p">@@ -14,12 +14,10 @@</span> end
 
 class ActionDispatch::IntegrationTest
   def assert_text(text)
<span class="gd">-    matching =
-      case text
-      when Regexp then text
-      else /#{text.squish}/
-      end
</span><span class="gi">+    assert_includes document_root_element.text.squish, text.squish
+  end
</span> 
<span class="gd">-    assert_match matching, document_root_element.text.squish
</span><span class="gi">+  def assert_no_text(text)
+    assert_not_includes document_root_element.text.squish, text.squish
</span>   end
 end
</code></pre></div></details>

          </aside>
      </article>
    </main>
  </body>
</html>
